<meta charset="utf-8">

<head>
	<script src="js/d3.js"></script>
	<script src="js/topojson.js"></script>

	<title>Criminal Activity in Iowa City</title>

	<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'> 
	<style>
		body {
			background-color: #e6e6e6;
		}
		.water {
			fill: #A7B4D9;
		}
		.buildings {
			fill: #F5D768;
		}
		.roads {
			fill: none;
			stroke: #000;
			stroke-width: .625px;
		}
	</style>
</head>

<body>
<div id="slider"></div>
<div id="map"></div>
<script>
	var margin = {top:50, right: 20, bottom: 20, left: 20},
		width = 960,
	    height = 600,
	    zoomScale = 409.25,
	    defTranslate = [0, 0];

	var projection = d3.geo.mercator()
		.scale(478822)
		.translate([765398, 383961]);
	var path = d3.geo.path()
		.pointRadius(1)
		.projection(projection);

	var timeFormat = d3.time.format("%m/%e/%Y  %H:%M"),
		timeScale = d3.time.scale().range([0, 12]);

	var test = d3.behavior.zoom()
		.size([960, 600])
		.translate([765396, 383859])
		.scale(1170)
		.scaleExtent([750, 2750]);

	var svg = d3.select("#map").append("svg")
	    .attr("width", width - margin.left - margin.right)
		.attr("height", height - margin.top - margin.bottom)
		.append("g")
		//.attr("transform", "translate(" + margin.left + "," + margin.top + ")")
		.call(test.on("zoom", redraw)),
	title = d3.select("#slider").append("svg")
		.attr("width", width)
		.attr("height", 57.5);


	function redraw() {
		projection.scale(d3.event.scale * zoomScale);

		var xTranslate = d3.event.translate[0] + defTranslate[0],
			yTranslate = d3.event.translate[1] + defTranslate[1];
		projection.translate([xTranslate, yTranslate]);

		console.log("Event Scale: ", d3.event.scale);
		console.log("Projection Scale: ", projection.scale());
		console.log("Projection Translation: ", projection.translate());
		
		svg.selectAll("path")
			.attr("d", path);
		svg.selectAll("circle")
			.attr("transform", function(d) {
				return "translate(" + projection([+d.longitude, +d.latitude]) + ")"; 
			});
		}

	d3.json("data/maps/ic-map.json", function(error, map) {

		svg.append("path")
			.datum(topojson.feature(map, map.objects.water))
			.attr("class", "water")
			.attr("d", path);

		svg.append("path")
			.datum(topojson.feature(map, map.objects.roads))
			.attr("class", "roads")
			.attr("d", path);

		svg.append("path")
			.datum(topojson.feature(map, map.objects.buildings))
			.attr("class", "buildings")
			.attr("d", path);

		});
	</script>
</body>